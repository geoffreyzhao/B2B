<!DOCTYPE html>
<html>
    <head>
    <title>邮轮 航线管理 添加团期</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="/static/css/smoothness/jquery-ui-1.10.3.custom.css">
    <link href="/static/css/kendo.common.css" rel="stylesheet" />
    <link href="/static/css/kendo.gray.css" rel="stylesheet" />
    <link href="/static/css/common.css" rel="stylesheet" />
    <link href="/static/css/supplier.css" rel="stylesheet" />
    <link href="/static/css/kendo.reset.css" rel="stylesheet" />
    <link href="/static/css/supplier_common.css" rel="stylesheet" />
    <link href="/static/css/supplierShip.css" rel="stylesheet" />

    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
    <script type="text/javascript" src="/static/js/kendo.web.js"></script>
    <script type="text/javascript" src="/static/js/cultures/kendo.culture.zh-CN.min.js"></script>
    <script type="text/javascript" src="/static/js/plugins/jquery.fixedBar.js"></script>
    <script type="text/javascript" src="/static/js/global.js"></script>
    <script type="text/javascript" src="/static/js/flight.js"></script>
    <script type="text/javascript" src="/static/js/jquery-ui-1.10.3.custom.js"></script>
    <script type="text/javascript" src="/static/js/i18n/jquery.ui.datepicker-zh-CN.js"></script>
    <script type="text/javascript" src="/static/js/supplier/supplier_travel.js"></script>
    <script type="text/javascript" src="/static/js/DateControl.js"></script>
    <script type="text/javascript" src="/static/js/vendor/underscore.js"></script>
    <!--[if IE]>
    <script src="/static/js/html5.js"></script>
    <![endif]-->
        
    <!--[if lt IE 8]> 
    <link rel="stylesheet" href="/static/css/ie.css" /> 
    <script type="text/javascript" src="/static/js/vendor/IE7.min.js"></script> 
    <![endif]-->
    <script type="text/javascript" src="/static/js/supplier/supplier_sync.js"></script>
    <!-- @CLB@ -->
    <style type="text/css">
        .lineWeight {
            box-shadow:none;
        }
        .k-tooltip {
            border: none;
        }
        .k-tooltip-closable .k-tooltip-content {
            padding-right: 20px;
        }
        .k-tooltip-content {
            padding: 0;
        }
    </style>
    </head>
<body>

    <div class="bg-header-repeat">
        <div class="bg-header-top"></div>
        <div class="navi-split-line"></div>
        <div class="main-header"></div>
    </div>

    <div id="container" class="new-container">
        <div class="header-top-center">
            <div class="head-left">
                <div class="supplier-logo"></div>
            </div>
            <ul class="first-navi">
                <li class="first-navi-li"><a href="javascript:void(0);">国内机票</a></li>
                <li class="first-navi-li"><a href="javascript:void(0);">国际机票</a></li>
                <li class="first-navi-li narrow-navi-word2"><a href="javascript:void(0);">旅游</a>
                </li>
                <li class="first-navi-li first-navi-active narrow-navi-word2"><a href="javascript:void(0);">邮轮</a>
                    <ol class="second-navi">
                        <li class="second-navi-li second-navi-active"><a href="javascript:void(0);">航线管理</a>
                            <div class="navi-slide-hover" style="height:5px;"></div>
                        </li>
                        <li class="second-navi-li"><a href="javascript:void(0);">团管理</a>
                            <div class="navi-slide-hover"></div>
                        </li>
                    </ol>
                </li>
                <li class="first-navi-li"><a href="javascript:void(0);">财务管理</a></li>
                <li class="user-setting-nav" style="display:none;">
                    <ol class="second-navi">
                        <li class="second-navi-li"><a href="javascript:void(0);">我的账号</a>
                            <div class="navi-slide-hover"></div>
                        </li>
                        <li class="second-navi-li"><a href="javascript:void(0);">公司信息</a>
                            <div class="navi-slide-hover"></div>
                        </li>
                        <li class="second-navi-li"><a href="javascript:void(0);">员工管理</a>
                            <div class="navi-slide-hover"></div>
                        </li>
                        <li class="second-navi-li"><a href="javascript:void(0);">角色管理</a>
                            <div class="navi-slide-hover"></div>
                        </li>
                        <li class="second-navi-li"><a href="javascript:void(0);">账户设置</a>
                            <div class="navi-slide-hover"></div>
                        </li>
                        <li class="second-navi-li"><a href="javascript:void(0);"><span style="font-size:14px;">OFFICE</span>管理</a>
                            <div class="navi-slide-hover"></div>
                        </li>
                    </ol>
                </li>
            </ul>
            <div class="head-right">
                <ul class="feature">
                    <li class="notice-icon-active"></li>
                    <li class="split-line"></li>
                    <li class="person-info">
                        <span class="person-icon"></span>
                        <span class="person-name" title="zhaoshuaigeng12312321">zhaoshuaigeng12312321</span>
                        <a class="logout" href="javascript:void(0);">退出</a>
                        <span class="user-setting">设置</span>
                    </li>
                </ul>
            </div>
        </div>
        <div class="clear"></div>
        <div id="sub_menu_bar"></div>

        <div id="mainContent" class="mainContent travelModule">
            <div class="top-pass-block">
                <ul class="third-navi">
                    <li class="third-navi-li third-navi-active">
                        <a class="blueFonts" href="javascript:void(0);"><i class="detailsIcon"></i>新增航线</a>
                    </li>
                    <li class="third-navi-li"><a href="javascript:void(0);">基本信息</a></li>
                    <li class="third-navi-li">
                        <a href="javascript:void(0);">行程安排</a>
                    </li>
                    <li class="third-navi-li">
                        <a href="javascript:void(0);">描述信息</a>                    
                    </li>
                    <li class="third-navi-li third-navi-active">
                        <a href="javascript:void(0);">团期报价</a>                    
                    </li>
                </ul>
            </div>

            <div class="mainBodyHead">
                <div class="lineNum">
                    <em class="numberContent fonts16">航线编号：23569</em>
                    <em class="shipName">【歌诗达邮轮-维多利亚号】 济州岛+福冈 5天</em>
                </div>
                <span class="mainBodyOper">
                    <span>
                        <a class="adaptiveButton brightBtn normalButton saveContentBtn">
                            <span class="left"></span>
                            <span class="center center_2">保存信息</span>
                            <span class="right"></span>
                        </a>
                    </span>
                    <span class="cancelLink">
                        <a href="">取消</a>
                    </span>
                </span>
            </div>

            <div class="mainBodyContent">
                <table class="tourDateInfoTb">
                    <tbody>
                        <tr>
                            <th>邮轮公司</th>
                            <td>歌诗达邮轮</td>
                        </tr>
                        <tr>
                            <th>船只</th>
                            <td>维多利亚号</td>
                        </tr>
                        <tr>
                            <th class="verticalTop"><em class="redStar">*</em>启航日期</th>
                            <td style="position:relative;">
                                <div class="addTourDateBtn">请选择启航日期</div>

                                <div class="tourDateBlock" style="display:none;">
                                    <div class="leftDateBlock">
                                        <div class="calendarOperation">
                                            <div class="calendarMonthLeft"></div>
                                            <div class="calendarDate cd1"></div>

                                        </div>
                                        <div class="calendar" class="calendarContainer" id="calendar01" >

                                        </div>
                                    </div>

                                    <div class="rightDateBlock">
                                        <div class="calendarOperation">
                                            <div class="calendarDate cd2"></div>
                                            <div class="calendarMonthRight"></div>
                                        </div>
                                        <div class="calendar" class="calendarContainer" id="calendar02">

                                        </div>
                                    </div>

                                    <div class="tourDateOpeBtn clearfix">
                                        <a class="adaptiveButton blueBtn sureSelectDate">
                                            <span class="left"></span>
                                            <span class="center">确 定</span>
                                            <span class="right"></span>
                                        </a>
                                        <a href="javascript:void(0);" class="cancelLink cancelSelectDate">取消</a>
                                    </div>
                                </div>

                                <div class="selectedDateBlock" style="display:none;">
                                    <div class="selectedDateList">
                                    </div>
                                    <div class="editTourDateBtn">修改启航日期</div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th><em class="redStar">*</em>是否包船</th>
                            <td>
                                <label><input type="radio" name="ifRentBoat">是</label>
                                <label><input type="radio" name="ifRentBoat">否</label>
                            </td>
                        </tr>
                        <tr>
                            <th><em class="redStar">*</em>截止收客时间</th>
                            <td>提前<input type="text" class="advanceDays">天</td>
                        </tr>
                    </tbody>
                </table>

                <div class="roomPriceMainBlock">
                
                    <div class="addRoomTypeBlock">
                        <div class="roomTypeNum">1.</div>                      
                        <table class="rtBasicInfoTb">
                            <tr>
                                <th><em class="redStar">*</em>舱型</th>
                                <td>
                                    <select data-role="dropdownlist" style="width:240px;">
                                        <option>标准海景房</option>
                                        <option>标准阳台房</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th><em class="redStar">*</em>房型</th>
                                <td>
                                    <select data-role="dropdownlist" style="width:240px;">
                                        <option>标准海景双人房</option>
                                        <option>标准阳台双人房</option>
                                    </select>
                                    <span class="roomDetail">房型详情</span>
                                    <div class="roomCapacity">可入住人数<em>5</em>人</div>
                                </td>
                            </tr>
                            <tr>
                                <th><em class="redStar">*</em>库存</th>
                                <td><input type="text" class="leftRoom">间</td>
                            </tr>
                            <tr>
                                <th><em class="redStar">*</em>价格维护</th>
                                <td></td>
                            </tr>
                        </table>
                        <div class="priceMaintainBlock">
                            <table>
                                <colgroup>
                                    <col width="75"/>
                                    <col width="75"/>
                                    <col width="75"/>
                                    <col width="75"/>
                                </colgroup>
                                <tbody>
                                    <tr class="mainTypePriceTr">
                                        <td colspan="4">结算价</td>
                                    </tr>
                                    <tr class="subTypePriceTr">
                                        <td>
                                            <p class="priceTitle">同舱1,2人</p>
                                        </td>
                                        <td>                                  
                                            <p class="adultPriceBg">成人</p>
                                            <p class="priceTitle">同舱3,4人</p>                                        
                                        </td>
                                        <td>
                                            <p class="childPriceBg">儿童</p>
                                            <p class="priceTitle">同舱3,4人</p>
                                        </td>
                                        <td>
                                            <p class="priceTitle">单人价</p>
                                        </td>
                                    </tr>
                                    <tr class="priceNum">
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <colgroup>
                                    <col width="75"/>
                                    <col width="75"/>
                                    <col width="75"/>
                                    <col width="75"/>
                                </colgroup>
                                <tbody>
                                    <tr class="mainTypePriceTr">
                                        <td colspan="4">建议同行价</td>
                                    </tr>
                                    <tr class="subTypePriceTr">
                                        <td>
                                            <p class="priceTitle">同舱1,2人</p>
                                        </td>
                                        <td>                                  
                                            <p class="adultPriceBg">成人</p>
                                            <p class="priceTitle">同舱3,4人</p>                                        
                                        </td>
                                        <td>
                                            <p class="childPriceBg">儿童</p>
                                            <p class="priceTitle">同舱3,4人</p>
                                        </td>
                                        <td>
                                            <p class="priceTitle">单人价</p>
                                        </td>
                                    </tr>
                                    <tr class="priceNum">
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <colgroup>
                                    <col width="75"/>
                                    <col width="75"/>
                                    <col width="75"/>
                                    <col width="75"/>
                                </colgroup>
                                <tbody>
                                    <tr class="mainTypePriceTr">
                                        <td colspan="4">建议市场价</td>
                                    </tr>
                                    <tr class="subTypePriceTr">
                                        <td>
                                            <p class="priceTitle">同舱1,2人</p>
                                        </td>
                                        <td>                                  
                                            <p class="adultPriceBg">成人</p>
                                            <p class="priceTitle">同舱3,4人</p>                                        
                                        </td>
                                        <td>
                                            <p class="childPriceBg">儿童</p>
                                            <p class="priceTitle">同舱3,4人</p>
                                        </td>
                                        <td>
                                            <p class="priceTitle">单人价</p>
                                        </td>
                                    </tr>
                                    <tr class="priceNum">
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="addRoomTypeBlockTemplate" style="display:none;">
                        <div class="roomTypeNum">1.</div>                        
                        <div class="delRoomPriceIcon">
                            <i></i>删除
                        </div>  
                        <table class="rtBasicInfoTb">
                            <tr>
                                <th><em class="redStar">*</em>舱型</th>
                                <td>
                                    <select data-role="dropdownlist" style="width:240px;">
                                        <option>标准海景房</option>
                                        <option>标准阳台房</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th><em class="redStar">*</em>房型</th>
                                <td>
                                    <select data-role="dropdownlist" style="width:240px;">
                                        <option>标准海景双人房</option>
                                        <option>标准阳台单人房</option>
                                    </select>
                                    <span class="roomDetail">房型详情</span>
                                    <div class="roomCapacity">可入住人数<em>5</em>人</div>
                                </td>
                            </tr>
                            <tr>
                                <th><em class="redStar">*</em>库存</th>
                                <td><input type="text" class="leftRoom">间</td>
                            </tr>
                            <tr>
                                <th><em class="redStar">*</em>价格维护</th>
                                <td></td>
                            </tr>
                        </table>
                        <div class="priceMaintainBlock">
                            <table>
                                <colgroup>
                                    <col width="75"/>
                                    <col width="75"/>
                                    <col width="75"/>
                                    <col width="75"/>
                                </colgroup>
                                <tbody>
                                    <tr class="mainTypePriceTr">
                                        <td colspan="4">结算价</td>
                                    </tr>
                                    <tr class="subTypePriceTr">
                                        <td>
                                            <p class="priceTitle">同舱1,2人</p>
                                        </td>
                                        <td>                                  
                                            <p class="adultPriceBg">成人</p>
                                            <p class="priceTitle">同舱3,4人</p>                                        
                                        </td>
                                        <td>
                                            <p class="childPriceBg">儿童</p>
                                            <p class="priceTitle">同舱3,4人</p>
                                        </td>
                                        <td>
                                            <p class="priceTitle">单人价</p>
                                        </td>
                                    </tr>
                                    <tr class="priceNum">
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <colgroup>
                                    <col width="75"/>
                                    <col width="75"/>
                                    <col width="75"/>
                                    <col width="75"/>
                                </colgroup>
                                <tbody>
                                    <tr class="mainTypePriceTr">
                                        <td colspan="4">建议同行价</td>
                                    </tr>
                                    <tr class="subTypePriceTr">
                                        <td>
                                            <p class="priceTitle">同舱1,2人</p>
                                        </td>
                                        <td>                                  
                                            <p class="adultPriceBg">成人</p>
                                            <p class="priceTitle">同舱3,4人</p>                                        
                                        </td>
                                        <td>
                                            <p class="childPriceBg">儿童</p>
                                            <p class="priceTitle">同舱3,4人</p>
                                        </td>
                                        <td>
                                            <p class="priceTitle">单人价</p>
                                        </td>
                                    </tr>
                                    <tr class="priceNum">
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <colgroup>
                                    <col width="75"/>
                                    <col width="75"/>
                                    <col width="75"/>
                                    <col width="75"/>
                                </colgroup>
                                <tbody>
                                    <tr class="mainTypePriceTr">
                                        <td colspan="4">建议市场价</td>
                                    </tr>
                                    <tr class="subTypePriceTr">
                                        <td>
                                            <p class="priceTitle">同舱1,2人</p>
                                        </td>
                                        <td>                                  
                                            <p class="adultPriceBg">成人</p>
                                            <p class="priceTitle">同舱3,4人</p>                                        
                                        </td>
                                        <td>
                                            <p class="childPriceBg">儿童</p>
                                            <p class="priceTitle">同舱3,4人</p>
                                        </td>
                                        <td>
                                            <p class="priceTitle">单人价</p>
                                        </td>
                                    </tr>
                                    <tr class="priceNum">
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                        <td><input type="text" placeholder="请输入" /></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="addRoomPriceBtn">
                        <i></i>添加房型价格
                    </div>
                </div>               

            </div>
            
        </div>

    </div>

    <div id="extFooter">
        <div>
            <p>
            <a href="javascript:void(0);">关于我们</a>&nbsp;|
            <a href="javascript:void(0);">微博</a>&nbsp;|
            <a href="javascript:void(0);">服务条款</a>&nbsp;|
            <a href="javascript:void(0);">隐私政策</a>&nbsp;|
            </p>
            <p>客户服务热线:400-720-6666</p>
        </div>
    </div>

    <script type="text/x-kendo-template" id="roomDetailPw">
        <div class="roomDetailPw">
            <table class="roomDetailPwTb roomStyleView">
                <colgroup>
                    <col width="90"/>
                    <col width="215"/>
                    <col width="80"/>
                    <col width="230"/>
                </colgroup>
                <tbody>
                    <tr>
                        <th>邮轮船只</th>
                        <td>双子星号</td>
                        <th><i class="redStar">*</i>实景图</th>
                        <td rowspan="4">
                            <div class="roomImgDiv">
                                <img src="../../../static/images/operator/cangfang_02.jpg" width="230" height="150">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><i class="redStar">*</i>房型名称</th>
                        <td>海景露台房</td>
                    </tr>
                    <tr>
                        <th><i class="redStar">*</i>舱型</th>
                        <td>内舱房</td>
                    </tr>
                    <tr>
                        <th><i class="redStar">*</i>代码</th>
                        <td>BA</td>
                    </tr>
                    <tr>
                        <th><i class="redStar">*</i>甲板</th>
                        <td>楼层1，楼层6，楼层12，楼层16</td>
                    </tr>
                    <tr>
                        <th><i class="redStar">*</i>面积</th>
                        <td>14.5㎡</td>
                    </tr>
                    <tr>
                        <th><i class="redStar">*</i>可入住人数</th>
                        <td>5</td>
                    </tr>
                    <tr>
                        <th class="verticalTop">介绍</th>
                        <td colspan="3">
                            私人露台、2张单人床及1张单人沙发床/1张双人大床及1张单人沙发床、电冰箱及DVD放映机。容纳人数：3人
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="operBtn">
                <a class="supplierButton brightRedBig_btn" style="font-size: 14px;">
                    <span class="left"></span>
                    <span class="center">保 存</span>
                    <span class="right"></span>
                </a>
                <a href="javascript:void(0);" class="cancelOper">取消</a>
            </div>
        </div>
    </script>

    <script type="text/x-kendo-template" id="selectedDateTemplate">
        # for (var i = 0; i < data.length; i++) { #
            <div class="selectedDateItem">
                <div class="topPart">
                    <span><input type="text" value="#= data[i].Format('YYYY-MM-DD') #" readonly="readonly"></span>
                    <i class="delItem"></i>
                </div>
                <div class="bottomPart">
                    <input type="text" value="#= data[i].Format('YYYYMMDD') #维多利亚号" readonly="readonly"/>
                    <i class="editItemName"></i>
                    <i class="sureEditItemName" style="display:none;"></i>
                </div>
            </div>
        # } #
    </script>

    <!--  编辑状态下的模板不允许删除 -->
    <script type="text/x-kendo-template" id="selectedDateModifyTemplate">
        # for (var i = 0; i < data.length; i++) { #
            <div class="selectedDateItem">
                <div class="topPart">
                    <span><input type="text" value="#= data[i].Format('YYYY-MM-DD') #" readonly="readonly"></span>
                </div>
                <div class="bottomPart">
                    <input type="text" value="#= data[i].Format('YYYYMMDD') #维多利亚号" readonly="readonly"/>
                    <i class="editItemName"></i>
                    <i class="sureEditItemName" style="display:none;"></i>
                </div>
            </div>
        # } #
    </script>

    <script>
        var today = new Date(),
            toDate=today;
        var nextMonthDate=new Date(today.getFullYear(),toDate.getMonth()+1,toDate.getDate());
        var template = kendo.template($("#selectedDateTemplate").html());

        $(function(){     

            $(".addRoomPriceBtn").click(function(){
                $(this).before("<div class='addRoomTypeBlock'>" + $(".addRoomTypeBlockTemplate").html() + "</div>");

                $(".addRoomTypeBlock").each(function(index){
                    $(this).find(".roomTypeNum").html((index + 1) + ".");
                });
                kendo.init('body');
            });

            $(".roomPriceMainBlock").delegate(".delRoomPriceIcon", "click", function(){
                $(this).parents(".addRoomTypeBlock").remove();

                $(".addRoomTypeBlock").each(function(index){
                    $(this).find(".roomTypeNum").html((index + 1) + ".");
                });
            });

            var roomDetailPw = new PopWindow('.roomDetail', {
                title:'房型信息',
                template:'#roomDetailPw',
                width:760,
                modal:true,
                open: function(){
                    console.log("在这里准备数据");
                }
            }).init();

            // 双日历初始化            

             var calendar=$("#calendar01").kendoCalendar({
                culture:"zh-CN",
                value:new Date(),
                footer:false
            }).data("kendoCalendar");

            var calendar1=$("#calendar02").kendoCalendar({
                culture:"zh-CN",
                value:nextMonthDate,
                footer:false,
                month:{
                    // content:$("#calendarTemplate").html()
                }
            }).data("kendoCalendar");

            $(".k-other-month a").remove();

            changeCalendarDateInfo(new Date());

            var array = [];
            $(".calendarMonthRight").click(function(){
                if(!$(this).hasClass("disabled")){
                    toDate=toDate.DateAdd("m",+1);
                    nextMonthDate=nextMonthDate.DateAdd("m",+1);

                    calendar.navigate(toDate,"month");
                    calendar1.navigate(nextMonthDate,"month");

                    $(".k-other-month a").remove();
                    changeCalendarDateInfo(toDate);

                    recoverCalendarSelected(array);
                }
            });

            $(".calendarMonthLeft").click(function(){
                if(!$(this).hasClass("disabled")) {
                    toDate=toDate.DateAdd("m",-1);
                    nextMonthDate=nextMonthDate.DateAdd("m",-1);

                    calendar.navigate(toDate,"month");
                    calendar1.navigate(nextMonthDate,"month");

                    $(".k-other-month a").remove();
                    changeCalendarDateInfo(toDate);

                    recoverCalendarSelected(array);
                }
            });
    
            // 新增团期时，点击日期添加背景样式 & array数组记录所有选中日期
            $("body").delegate(".calendar td", "click", function(){
                if ($(this).children("a").length != 0) {   //  空日期没有点击事件
                    var s = replaceChineseYMD($(this).children("a").attr("title"));

                    if ($(this).hasClass("dateSelect")) {
                        $(this).removeClass("dateSelect");
                        array = _.without(array, s);
                    } else {
                        $(this).addClass("dateSelect");                    
                        array.push(s);
                    }
                }
            });

            // 编辑状态下，日历中日期只能单选
            /*
            $("body").delegate(".calendar td", "click", function(){
                if ($(this).children("a").length != 0) {   //  空日期没有点击事件
                    $(".calendar td").removeClass("dateSelect");
                    array = [];
                    $(this).addClass("dateSelect");

                    $(".calendar td").each(function(){
                        if ($(this).hasClass("dateSelect")) {
                            array.push(replaceChineseYMD($(this).children("a").attr("title")));
                        }
                    });             
                }
            });
            */

            // 添加团期
            $("body").delegate(".addTourDateBtn", "click", function(){
                $(this).hide();
                $(".tourDateBlock").show();
            });

            // 确定团期选择
            $("body").delegate(".sureSelectDate", "click", function(){
                $(".tourDateBlock").hide();
                $(".selectedDateItem").remove();
                var dateArr = [];

                // $(".calendar td.dateSelect").each(function(){

                //     var d = new Date($(this).children("a").attr("title").replace('年', '-').replace('月', '-').replace('日', ''));
                //     dateArr.push(d);
                // });
                for (var i = 0; i < array.length; i++) {
                    dateArr.push(new Date(array[i]));
                }
                $(".selectedDateList").html(template(dateArr));
                $(".selectedDateBlock").show();
            });

            // 取消团期选择，返回修改团期或返回添加团期
            $("body").delegate(".cancelSelectDate", "click", function(){
                if ($(".selectedDateItem").length == 0) {    //  没有已选中日期，清空选中，返回到添加团期
                    $(".tourDateBlock").hide();
                    $(".calendar td.dateSelect").removeClass("dateSelect");
                    $(".addTourDateBtn").show();

                } else {    //  恢复数据，返回至修改团期
                    $(".tourDateBlock").hide();

                    var arr = [];
                    $(".selectedDateItem").each(function(){
                        arr.push($(this).find(".topPart span input").val());
                    });

                    array = arr;

                    $(".calendar td").each(function(){
                        $(this).removeClass("dateSelect");

                        if ($(this).children("a").length != 0 && $.inArray(replaceChineseYMD($(this).children("a").attr("title")), arr) != -1) {
                            $(this).addClass("dateSelect");
                        }
                    });
                    
                    $(".selectedDateBlock").show();
                }
            });

            // 选中日期的操作
            // 编辑文本框 
            $("body").delegate(".editItemName", "click", function(){
                $(this).siblings("input").removeAttr("readonly");
                $(this).hide();
                $(this).siblings(".sureEditItemName").show();
            });

            // 确认编辑保存
            $("body").delegate(".sureEditItemName", "click", function(){
                $(this).siblings("input").attr("readonly", "readonly");
                $(this).hide();
                $(this).siblings(".editItemName").show();
            });

            // 删除日期
            $("body").delegate(".delItem", "click", function(){
                $(this).parents(".selectedDateItem").remove();
                array = _.without(array, $(this).parent().find("span input").val());
                
                var dateStr = $(this).siblings("span").html();
                $(".calendar td.dateSelect").each(function(){
                    if (dateStr == replaceChineseYMD($(this).children("a").attr("title"))) {
                        $(this).removeClass("dateSelect");
                    }
                });

                if ($(".selectedDateItem").length == 0) {
                    $(".selectedDateBlock").hide();
                    $(".addTourDateBtn").show();
                }

            });

            // 新增团期时，修改团期
            $("body").delegate(".editTourDateBtn", "click", function(){
                $(".selectedDateBlock").hide();
                $(".tourDateBlock").show();

                today = new Date(array[0]);
                toDate = today;
                nextMonthDate = new Date(today.getFullYear(),toDate.getMonth()+1,toDate.getDate()); 
                calendar.navigate(toDate,"month");
                calendar1.navigate(nextMonthDate,"month");

                $(".k-other-month a").remove();
                changeCalendarDateInfo(toDate);

                $(".calendar td").each(function(){
                    if ($(this).children("a").length != 0 && $.inArray(replaceChineseYMD($(this).children("a").attr("title")), array) != -1) {
                        $(this).addClass("dateSelect");
                    }
                });
            });

            //  编辑团期时，修改团期
            /*
            $("body").delegate(".editTourDateBtn", "click", function(){
                $(".selectedDateBlock").hide();
                $(".tourDateBlock").show();

                array = [];
                array.push("2015-01-02"); // 清除array,放进去后台的数据

                today = new Date(array[0]);
                toDate = today;
                nextMonthDate = new Date(today.getFullYear(),toDate.getMonth()+1,toDate.getDate()); 
                calendar.navigate(toDate,"month");
                calendar1.navigate(nextMonthDate,"month");

                $(".k-other-month a").remove();
                changeCalendarDateInfo(toDate);

                $(".calendar td").each(function(){
                    if ($(this).children("a").length != 0 && $.inArray(replaceChineseYMD($(this).children("a").attr("title")), array) != -1) {
                        $(this).addClass("dateSelect");
                    }
                });
            });
            */

        })

        function changeCalendarDateInfo(toDate){
            $(".calendarDate.cd1").html(toDate.getFullYear()+"年"+(toDate.getMonth()+1)+"月");
            $(".calendarDate.cd2").html(nextMonthDate.getFullYear()+"年"+(nextMonthDate.getMonth()+1)+"月");
        }

        function recoverCalendarSelected(array) {
            $(".calendar td").each(function(){
                if ($(this).hasClass("dateSelect")) {
                    $(this).removeClass("dateSelect");
                } else {
                    if ($(this).children("a").length != 0 && $.inArray(replaceChineseYMD($(this).children("a").attr("title")), array) != -1) {
                        $(this).addClass("dateSelect");
                    }
                }
            });
        }

        function replaceChineseYMD(str) {
            var dateStr = str.replace('年', '-').replace('月', '-').replace('日', '');
            var tmpArr = dateStr.split('-');

            var month = tmpArr[1] < 10 ? ("0" + tmpArr[1]) : tmpArr[1];
            var day = tmpArr[2] < 10 ? ("0" + tmpArr[2]) : tmpArr[2];

            return tmpArr[0] + "-" + month + "-" + day;
        }
    </script>   
    
</body>
</html>
