<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>天地行 采购商 详情页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="../../static/css/smoothness/jquery-ui-1.10.3.custom.css" />
    <link rel="stylesheet" href="../../static/css/store_v2/store.css"/>
    <link rel="stylesheet" href="../../static/css/store_reset.css" media="all" />
    <link rel="stylesheet" href="../../static/css/kendo.common.min.css" />
    <link rel="stylesheet" href="../../static/css/kendo.store.css" />
    <link rel="stylesheet" href="../../static/css/toolkit.css"/> 
    <link rel="stylesheet" type="text/css" href="../../static/css/store_localTravel.css">
    
    <script type="text/javascript" src="../../static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../static/js/kendo.web.js"></script>
    <script type="text/javascript" src="../../static/js/cultures/kendo.culture.zh-CN.min.js"></script>
    <script type="text/javascript" src="../../static/js/global.js"></script>
    <script type="text/javascript" src="../../static/js/store/store.js"></script>
    <script type="text/javascript" src="../../static/js/DateControl.js"></script>
    <script type="text/javascript" src="../../static/js/jquery.cycle.all.js"></script>


    <!--[if IE]>
    <script src="../../static/js/html5.js"></script>
    <script src="../../static/js/vendor/IE7.min.js"></script>
    <![endif]-->
</head>
<body>

<div class="customerCenterContainer off">
    <div class="customerCenterButton">
        <div>用户中心</div>
    </div>
    <div class="customerCenterItemsContainer">
        <div class="customerCenterItemsPanel">
            <i></i>
            <ul>
                <li class="cc_orderManagerment"><div>订单管理</div></li>
                <li class="cc_e-wallet"><div>电子钱包</div></li>
                <li class="cc_statisticalReport"><div>统计报表</div></li>
                <li class="cc_customerService"><div>客户服务</div></li>
                <li class="cc_notice"><div>公告</div></li>
                <li class="cc_message"><div>消息</div></li>
                <li class="cc_onlineService"><div>在线客服</div></li>
            </ul>
        </div>
    </div>
</div>

<div class="headBG">
    <header class="main-header">
        <a class="logo" href="/"><h1>天地行</h1></a>
        <nav class="main-nav">
            <ul class="clearfix">
                <li><a href="#">国内机票</a></li>
                <li><a href="#">国际机票</a></li>
                <li><a href="#">保险</a></li>
                <li><a href="#">酒店</a></li>
                <li><a href="#">机 + 酒</a></li>
                <li><a href="#">旅游</a></li>
                <li><a href="#">邮轮</a></li>
                <li class="active"><a href="#">当地游</a></li>
            </ul>
        </nav>
    </header>
</div>

<div class="main-wrapper">
       
<section class="main-body clearfix"> <!--body start-->
    <div class="mainContainer">
        <div class="travel_birthland_destination">
            <span class="birthland orangeFonts">当地游</span>
            <i class="icon-right-open-1"></i> 
            <span class="orangeFonts">日本</span>
            <i class="icon-right-open-1"></i>
            <span class="orangeFonts">东京</span>
            <i class="icon-right-open-1"></i>
            <span class="destination">富士山、芦之湖、箱根一日游（东京出发，含新干线车票）</span>
        </div>
        <div class="tripInfoAndBooking clearfix">
            <div class="leftBookImg">
                <div id="picarea">
                    <div class="showGraph" id="bigpicarea">
                        <p class="bigbtnPrev" style="display:none;">
                            <span id="big_play_prev"></span>
                        </p>
                        <div id="slideshow" class="pics">
                            <img src="../../static/images/store/cruise/shippingImg01.jpg"/>
                            <img src="../../static/images/store/cruise/shippingImg02.jpg"/>
                            <img src="../../static/images/store/cruise/shippingImg03.jpg"/>
                            <img src="../../static/images/store/cruise/shippingImg01.jpg"/>
                            <img src="../../static/images/store/cruise/shippingImg02.jpg"/>
                            <img src="../../static/images/store/cruise/shippingImg03.jpg"/>
                            <img src="../../static/images/store/cruise/shippingImg01.jpg"/>
                            <img src="../../static/images/store/cruise/shippingImg02.jpg"/>
                            <img src="../../static/images/store/cruise/shippingImg03.jpg"/>
                            <img src="../../static/images/store/cruise/shippingImg01.jpg"/>
                            <img src="../../static/images/store/cruise/shippingImg02.jpg"/>
                        </div>
                        <p class="bigbtnNext" style="display:none;">
                            <span id="big_play_next"></span>
                        </p>
                    </div>
                    <div class="smallpicarea">
                        <div class="smallBtnPrev"></div>
                        <div id="smallSlideShow" class="smallSlideShow"></div>
                        <div class="smallBtnNext"></div>
                    </div>
                </div>
            </div>
            <div class="tripInfoAndBooking_right">
                <ul class="tripTopTitle">
                    <li class="tripName">
                        <p class="color333">富士山、芦之湖、箱根一日游 （东京出发，含新干线车票）</p>
                        <div>
                            <label class="minWidth195">
                                <span>产品编号：</span>
                                <span class="color333">60891</span>
                            </label>
                            <label class="minWidth195">
                                <span>供应商：</span>
                                <span class="color333">不夜城</span>
                            </label>
                            <label class="minWidth195">
                                <span>目的地：</span>
                                <span class="color333">东京</span>
                            </label>
                            <label class="minWidth195">
                                <span>游玩时长：</span>
                                <span class="color333">4h30m</span>
                            </label>
                        </div>
                        <div class="greenLabel">
                            <span class="greenBgFonts">自然风光</span>
                            <span class="greenBgFonts">人为</span>
                            <span class="greenBgFonts">自然风光</span>
                        </div>
                    </li>
                    <li>
                        <span class="importantTxt1" style="font-size:18px;">￥
                            <span style="font-size: 30px;">16500</span>
                            <span style="font-size:14px;color:#333;">起</span>
                        </span>
                        <span class="spExplain">起价说明</span>
                    </li>
                    <li>
                        <div class="moreDetails">
                            从东京出发，游览日本最煮米鞥的景点。前往热门的富士山第五火车站，乘船观光芦之湖，乘坐空中缆车至苟月山丘山顶，观壮丽的大涌谷火山山谷。最后乘坐新干线火车回东京，让您拥有一次无忧无虑的旅行 让您拥有一次无忧无虑的旅行让您拥有一次无忧无虑的旅行
                        </div>
                        <div class="view-more-text">
                            <span>查看更多</span><i class="icon-arrow-down"></i>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="clearfix"></div>
        <div id="priceCalendar">
            <ul class="tabSwitchMonth">
            </ul>
            <div class="calendarTitle clearfix">
                <span>日</span>
                <span>一</span>
                <span>二</span>
                <span>三</span>
                <span>四</span>
                <span>五</span>
                <span>六</span>
            </div>
            <div class="clearfix"></div>
            <div class="calendarTables">
            </div>
        </div>
        <div class="tripDetailInfo">
            <ul class="changeList clearfix">
                <li><a href="#tripDetail"><i></i>线路行程</a></li>
                <li class="liLine"></li>
                <li><a href="#priceExplain" class="currentLi"><i></i>费用说明</a></li>
                <li class="liLine"></li>
                <li><a href="#bookingNote"><i></i>预订须知</a></li>
                <li class="liLine"></li>
                <li><a href="#visaInfo"><i></i>签证信息</a></li>
                <li class="liLine"></li>
                <li><a href="#otherInfo"><i></i>其他</a></li>
                <li style="float:right">
                    <span class="btn_booking">立即预订</span>                    
                </li>
            </ul>
            <div class="tripDetail">
                <a href="#" name="tripDetail"></a>
                dfgdgggdfggdgdgdgsd
            </div>
            <div class="tripDetailOtherInfo">
                <div class="tdoi_title">费用说明
                    <a href="#" name="priceExplain"></a>
                </div>
                
                <div class="tdoi_title">预订须知
                    <a href="#" name="bookingNote"></a>
                </div>
                
                <div class="tdoi_title">签证信息
                    <a href="#" name="visaInfo"></a>
                </div>

                <div class="tdoi_title">其他
                    <a href="#" name="otherInfo"></a>
                </div>
                
            </div>
        </div>
    </div>
</section>


 <!--body end-->

<!--footer start-->
<footer class="main-footer">
    <center>
        <a href="#">隐私问题</a>
        <i class="bar">|</i>
        <a href="#">常见问题</a>
        <i class="bar">|</i>
        <a href="#">关于我们</a>
        <i class="bar">|</i>
        <a href="#">媒体中心</a>
        <i class="bar">|</i>
        <a href="#">联系我们</a>
    </center>
    <center class="copyright">
        Copyright &copy; 2014 天地行 All Rights Reserved.     沪ICP备08101503号
    </center>
</footer>
</div>

<script type="text/html" id="bookingTemplate">
    <div class="bookingContainer2">
        <div class="hideBorderBot"></div>
        <table>
            <colgroup>
                <col width="60"/>
                <col width="70"/>
                <col width="50"/>
            </colgroup>
            <tr>
                <td>
                    <span class="unimportantTxt63">成人&nbsp;</span>
                </td>
                <td>
                    <span class="importantTxt1">￥986</span>
                </td>
                <td>
                    <span class="unimportantTxt63">充足</span>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="unimportantTxt63">儿童&nbsp;</span>
                </td>
                <td>
                    <span class="importantTxt1">￥986</span>
                </td>
                <td>
                    <span class="unimportantTxt63">充足</span>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="unimportantTxt63">婴儿&nbsp;</span>
                </td>
                <td>
                    <span class="importantTxt1">￥986</span>
                </td>
                <td>
                    <span class="unimportantTxt63">充足</span>
                </td>
            </tr>
        </table>
    </div>
</script>

<script type="text/javascript">
    $(function(){
        
        // 图片轮播效果,当多于1张照片时，调用轮播效果，否则只展示一张图片

        if ($("#slideshow").find("img").length > 1) {
            $('#slideshow').cycle({
                fx:     'scrollHorz',
                speed:  'fast',
                timeout: 2000,
                prev: ".bigbtnPrev, .smallBtnPrev",
                next: ".bigbtnNext, .smallBtnNext",
                pager:  '#smallSlideShow',
                pagerAnchorBuilder: function(idx, slide) {
                    return '<span class="slideshowItem" style="left:' + (97 * idx) + 'px"><a href="#"><img src="' + slide.src + '" width="90" height="56" /></a></span>';
                },
                before: function(currSlideElement, nextSlideElement, options, forwardFlag){
                    // before 方法用来处理小图片轮播效果
                    if (options.currSlide > 3) {      //  当前小图片slide超过第五张图片时              
                        $(".slideshowItem").each(function(i){
                            var currLeftValStr = $(this).css("left");
                            var changeLeftValStr = currLeftValStr.substring(0, currLeftValStr.length - 2);
                            // var changeLeftValNum = parseInt(changeLeftValStr - 97 * 5);
                            var changeLeftValNum = parseInt(changeLeftValStr - 97);

                            // if (changeLeftValNum < 0) {
                            //     changeLeftValNum = parseInt($(".slideshowItem:last-child").css("left").substring(0, currLeftValStr.length - 2)) - 97 * 5;
                            // }
                            $(this).css("left", changeLeftValNum + "px");
                        });

                        if (options.currSlide == options.slideCount - 1) {
                            //  当前小图片slide为最后一张图片时
                            options.currSlide = 0;
                            $(".slideshowItem").each(function(index){
                                $(this).css("left", (index * 97) + "px");
                            });
                        }
                    }
                }
            });
        } else {
            var imgSrc = $("#slideshow").find("img").attr('src');
            $("#smallSlideShow").append("<span class='slideshowItem activeSlide' style='left:0;'>" +
                    "<a href='#'><img src='" + imgSrc + "' width='90' height='56'></a></span>");
        }

        var a_pos = [];
        var flag=true;
        $(".changeList a").each(function(index){
            var href= $(this).attr("href");
            a_pos.push($("a[name=" + href.substring(1) + "]").offset());

        });

        $(".changeList a").click(function(e){
            flag=false;
            e.preventDefault();
            $(this).closest("li").siblings().find("a").removeClass('currentLi');
            $(this).addClass("currentLi");
            var i=$(this).closest("li").index();
            i-=Math.round(i/2);
            $("html,body").animate({"scrollTop":a_pos[i].top-42},1);
        });

        $(window).bind("scroll",function(e){
            if(flag){
                var that = $(".changeList");
                var currentPos = that.offset();
                var i = 0;
//                console.dir(a_pos);
                for(i = a_pos.length - 1; i >=0 ; i--){
                    if(currentPos.top >= a_pos[i].top-45){
                        that.find("a").removeClass('currentLi');
                        $("a:eq(" + (i) + ")" , that).addClass("currentLi");
                        return false;
                    }
                }
                that.find("a").removeClass('currentLi');
                $("a:first" , that).addClass("currentLi");
            }
            flag=true;
        });

        $(".changeList").fixedBar();

        var data = [
            { month : "2015/02/01",   // 日期格式需要注意，不同浏览器下识别情况不同，写个通用的格式
              info : [
                { dayDate: 1, isMultiTour: false, price: 1950},
                { dayDate: 12, isMultiTour: false, price: 950},
                { dayDate: 25, isMultiTour: false, price: 350}
              ]
            },
            { month : "2015/03/01",
              info : [
                { dayDate: 15, isMultiTour: false, price: 950},
                { dayDate: 23, isMultiTour: false, price: 750}
              ]
            },
            { month : "2015/05/01",
              info : [
                { dayDate: 12, isMultiTour: false, price: 150},
                { dayDate: 20, isMultiTour: false, price: 650}
              ]
            }
        ];

        setTabSwitchMonth("#priceCalendar .tabSwitchMonth", data);

        /*  切换月份 */      
        $("body").delegate("#priceCalendar .tabSwitchMonth li", "click", function(){
            $(this).addClass("tabCurrentMonth");
            $(this).siblings("li").removeClass("tabCurrentMonth");

            showCurrentCalendar("#priceCalendar");
            addEnableTd();
        });

        $("body").delegate("#priceCalendarPw .tabSwitchMonth li", "click", function(){
            $(this).addClass("tabCurrentMonth");
            $(this).siblings("li").removeClass("tabCurrentMonth");

            showCurrentCalendar("#priceCalendarPw");
            addEnableTd();
        });

        // 生成日历
        setCalendar(data, "#priceCalendar .calendarTables");        

        // 显示当前月份日历
        showCurrentCalendar("#priceCalendar");        

        // 为日期 添加点击弹窗
        addEnableTd();

        var normalTourOrderFL = new FloatLayer({
            trigger: "#priceCalendar .enableTd",
            template:"#bookingTemplate",
            type:'hover',
            data: "",
            expectClose: false,
            offsetX: 0,
            offsetY: 55
        });

        $("#priceCalendar .calTable").on("click", ".enableTd .hasBorderTd", function(){
            var clickCurrentDay = $(this).children(".dateDay").html();
            var $currentDate = $(".tabCurrentMonth").attr("name");
            var showDate = $currentDate.split('/')[0] + "-" + $currentDate.split('/')[1] + "-" + clickCurrentDay;
//            $(this).parents("#priceCalendar").find(".hasBorderTd").removeClass("hasBorderTdActive");
//            $(this).addClass("hasBorderTdActive");
          
        });

        $("body").delegate(".bookingContainer2.multiTem .departureInfo", "click", function(){
            $(this).siblings("ul.mtSelectItems").toggle();
        });

        $("body").delegate('.multiTem .mtSelectItems li', 'click', function() {
            $(".mtSelectedItem").html($(this).html());
            $(".mtSelectedItem").show();
            $(".mtSelectItems").hide();
        });

        var geneCalendarFlag = false;
        $(".largeBtnOrange.orderNow").click(function(){            
            
            if (!geneCalendarFlag) {
                setTabSwitchMonth("#priceCalendarPw .tabSwitchMonth", data);
                setCalendar(data, "#priceCalendarPw .calendarTables");
                showCurrentCalendar("#priceCalendarPw");
                addEnableTd();
            }
            geneCalendarFlag = true;

            // 把弹窗上的事件放在 click事件外面  试试
            $("#priceCalendarPw td").each(function(){
                $(this).click(function(){
                    if ($(this).hasClass("enableTd")) {  //  没有多团标志
                        $(".normalTourBlock .boldDate").html(geneFormatDate($(this).find(".dateDay").html()));
                        $(".normalTourBlock").show();                        
                        $(".normalTourBlock").siblings("div").hide();

                        $(this).parents(".priceCalendarPw").find(".hasBorderTd").removeClass("hasBorderTdActive");
                        $(this).find(".hasBorderTd").addClass("hasBorderTdActive");

                    } else if ($(this).hasClass("enableTdMt")) {   // 多团标志
                        $(".multiTourBlock .boldDate").html(geneFormatDate($(this).find(".dateDay").html()));
                        $(".multiTourBlock").show();
                        $(".multiTourBlock").siblings("div").hide();

                        $(this).parents(".priceCalendarPw").find(".hasBorderTd").removeClass("hasBorderTdActive");
                        $(this).find(".hasBorderTd").addClass("hasBorderTdActive");
                    }
                });
            });

            $(".priceCalendarPw").delegate(".departureInfo", "click", function(){
                $(this).siblings("ul.mtSelectItems").toggle();
            });

            $(".priceCalendarPw").delegate('.mtSelectItems li', 'click', function() {
                $(".priceCalendarPw .mtSelectedItem").html($(this).html());
                $(".priceCalendarPw .mtSelectedItem").show();
                $(".priceCalendarPw .mtSelectItems").hide();
            });
        });

    });

    function geneFormatDate(d) {
        var tem = $(".priceCalendarPw .tabCurrentMonth").attr("name");
        return tem.split('/')[0] + "-" + tem.split('/')[1] + "-" + d;
    }

    function geneTabSwitchMonth(data) {
        var liStr = "";
        for (var i = 0; i < data.length; i++) {
            var temp = new Date(data[i].month);

            if (temp.getFullYear() == new Date().getFullYear()) {
                liStr += "<li name='" + data[i].month + "'>" + (temp.getMonth() + 1) + "月</li>";
            } else {
                liStr += "<li name='" + data[i].month + "'>" + temp.getFullYear() + "年" +
                        (temp.getMonth() + 1) + "月</li>";
            }
        }
        return liStr;
    }

    function setTabSwitchMonth(ele, data) {
        $(ele).append(geneTabSwitchMonth(data));
        $(ele).children("li").eq(0).addClass("tabCurrentMonth");
    }

    function setCalendar(data, ele) {
        for (var i = 0; i < data.length; i++) {
            var monthInfo = data[i];  // 获得当前月份的数据信息

            var calStr = "<table class='calTable ct-" + data[i].month.split('/')[0] + "-" +
                            data[i].month.split('/')[1] + "'><tr>";  // 拼接字符串生成表格日期内容

            var curentMonthDate = new Date(monthInfo.month);
            var nextMonthDate = new Date(curentMonthDate.getFullYear(), curentMonthDate.getMonth() + 1,
                curentMonthDate.getDate());
            var monthDays = (nextMonthDate - curentMonthDate)/(1000*60*60*24);  // 获得当前月天数

            var firstWeekDay = curentMonthDate.getDay();  // 获得当前月1号是周几, 范围0-6
            var lastWeekDay = nextMonthDate.getDay() - 1 < 0 ? 6 : nextMonthDate.getDay() - 1; 
            // 计算当月最后一天是周几，填补日历最后的空格

            var currentDay = 1;  // 从1号开始排列当月的日期

            for (var j = 0; j < firstWeekDay; j++) {  // 当月1号之前td为空
                calStr += "<td></td>";
            }

            for (; currentDay <= monthDays; currentDay++) {

                var w1 = firstWeekDay == 0 ? 7 : firstWeekDay;

                if (currentDay % 7 == (7 - w1) && currentDay != monthDays) {
                    calStr += "<td>" + geneTdContent(currentDay, monthInfo) + "</td></tr><tr>";
                } else if (currentDay == monthDays) {
                    calStr += "<td>" + geneTdContent(currentDay, monthInfo) + "</td>";
                    for (var t = 0; t < 6 - lastWeekDay; t++) {
                        calStr += "<td></td>";
                    }
                    calStr += "</tr></table>";
                } else {
                    calStr += "<td>" + geneTdContent(currentDay, monthInfo) + "</td>";
                }
            }
            $(ele).append(calStr);
        }
    }

    function showCurrentCalendar(ele) {
        $(ele).find(".calendarTables table").hide();
        $(ele).find(".tabSwitchMonth li").each(function(index){
            if ($(this).hasClass("tabCurrentMonth")) {
                $(ele).find(".calendarTables table").eq(index).show();
            }
        });
    }

    function getDayInfo(currentDay, monthInfo) {
        for (var i = 0; i < monthInfo.info.length; i++) {
            if (monthInfo.info[i].dayDate == currentDay) {
                return monthInfo.info[i];
            }
        }
        return null;
    }

    function geneTdContent(currentDay, monthInfo) {
        var dayInfo = getDayInfo(currentDay, monthInfo);
        var tdCont = "";
        
        if (!!dayInfo) {            

            // 售罄状态下 td内所有元素都是灰色
            if (dayInfo.leftNum == 0) {
                tdCont += "<span class='dateDay disa-dateDay'>" + dayInfo.dayDate + "</span>";
                tdCont += "<i class='multiTour disa-multiTour'></i>";
                /*tdCont += "<span class='leftNum leftNone'>售罄</span>";*/
                tdCont += "<span class='price disa-price'>￥<b>" + dayInfo.price + "</b>起</span>";
                tdCont += "<i class='tourFlag disa-sureTour'></i>";
            } else {
                tdCont += "<div class='hasBorderTd'><span class='dateDay'>" + dayInfo.dayDate + "</span>";

                if (dayInfo.leftNum > 20) {
                    tdCont += "<span class='leftNum leftMore'>充足</span>";
                } else {               
                    tdCont += "<span class='leftNum leftNormal'>" + "</span>";
                }

                tdCont += "<span class='price'>￥<b>" + dayInfo.price + "</b>起</span>";

                // 是否有多团标志
                if (dayInfo.isMultiTour) {
                    tdCont += "<i class='multiTour'></i>";
                }

                // 判断成团类型  tourFlag: 0 不成团, 1 成团,  2 铁定成团
                if (dayInfo.tourFlag == 1) {
                    tdCont += "<i class='tourFlag tour'></i>";
                } else if (dayInfo.tourFlag == 2) {
                    tdCont += "<i class='tourFlag sureTour'></i></div>";
                }
                
            }
        } else {
            tdCont += "<span class='dateDay disa-dateDay'>" + currentDay + "</span>";
        }
        return tdCont;
    }

    function addEnableTd() {
        $(".leftNormal, .leftMore").parents("td").each(function(){
            if ($(this).find(".multiTour").length == 0) {
                $(this).addClass("enableTd");
            } else {
                $(this).addClass("enableTdMt");
            }
        });
    }

    $("body").delegate(".view-more-text", "click", function(){
        if ($(this).find("i").hasClass("icon-arrow-down")) { // 当前为收起状态
            $(this).find("i").removeClass("icon-arrow-down");
            $(this).find("i").addClass("icon-arrow-up");
            $(this).find("span").html("收起");
            $(this).siblings(".moreDetails").css({
                height: "auto",
                overflow: "visible"
            });
        } else if ($(this).find("i").hasClass("icon-arrow-up")) {
            $(this).find("i").removeClass("icon-arrow-up");
            $(this).find("i").addClass("icon-arrow-down");
            $(this).find("span").html("查看更多");
            $(this).siblings(".moreDetails").css({
                height: "90px",
                overflow: "hidden"
            });
        }
    });

</script>

</body>
</html>

